- name: Build Gemini prompt
  id: prompt
  run: |
    # Get commit message
    COMMIT_MSG=$(git log -1 --pretty=format:"%s%n%n%b")

    # Get git diff (can be large)
    GIT_DIFF=$(git show --pretty="" --unified=4)

    # Determine current version
    VERSION=$(grep -oP 'v\K[0-9]+\.[0-9]+\.[0-9]+' ul.html | head -n 1)
    if [ -z "$VERSION" ]; then VERSION="1.0.0"; fi

    # Increment patch version
    IFS='.' read -r MAJ MIN PATCH <<< "$VERSION"
    PATCH=$((PATCH + 1))
    NEW_VERSION="$MAJ.$MIN.$PATCH"

    # Build prompt for Gemini
    {
      echo "text<<EOF"
      echo "<div class=\"update-item\" style=\"--delay: 1\">"
      echo "<span class=\"version\">v$NEW_VERSION</span>"
      echo "<h3>[TITLE]</h3>"
      echo "<p>[DESCRIPTION]</p>"
      echo "</div>"
      echo ""
      echo "Rules:"
      echo "- Keep class names EXACTLY the same."
      echo "- Replace [TITLE] with a short summary of the commit."
      echo "- Replace [DESCRIPTION] with a simple explanation of the changes."
      echo "- Do NOT add markdown, bullets, or extra formatting."
      echo ""
      echo "Commit Message:"
      echo "$COMMIT_MSG"
      echo ""
      echo "Git Diff:"
      echo "$GIT_DIFF"
      echo ""
      echo "EOF"
    } >> $GITHUB_OUTPUT
